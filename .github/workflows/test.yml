name: Test action

on:
  workflow_dispatch:
    inputs:
      commits:
        description: "List of Commits (https://developer.github.com/v3/repos/commits/#list-commits)"
      previousReleaseTagNameOrSha:
        description: "Tag Name or SHA of previous release"
      nextReleaseTagName:
        description: "Tag Name of next release"
      nextReleaseName:
        description: "Friendly Name of next release"
      configFilePath:
        description: "Path to custom config (optional)"
        required: false

jobs:
  changelog:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Changelog
        id: changelog
        uses: ./
        with:
          previousReleaseTagNameOrSha: ${{ github.event.inputs.previousReleaseTagNameOrSha }}
          nextReleaseTagName: ${{ github.event.inputs.nextReleaseTagName }}
          nextReleaseName: ${{ github.event.inputs.nextReleaseName }}
          commits: '[{"hash":"1fc76845b2b4679968d97951f31d7f3759d6b86a","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-27T02:47:12Z"},"message":"chore: Release 2020-07-27 02:46:52Z (#16)\n\nCo-authored-by: gitHub-actions <mrchief mrchief@users.noreply.github.com>\n\nFixes #123"},"html_url":"https://github.com/mrchief/actions-test/commit/1fc76845b2b4679968d97951f31d7f3759d6b86a"},{"hash":"9eece8cda610273911c0396ea016b618ce040a00","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-27T02:46:16Z"},"message":"feat: Remove extra call thats not needed anymore\n\nFixes #12\nFixes#34"},"html_url":"https://github.com/mrchief/actions-test/commit/9eece8cda610273911c0396ea016b618ce040a00"},{"hash":"b09fc019cb9497d31d483f66b796b4ad5faa14a4","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-27T02:40:09Z"},"message":"fix: GH API doesnt return commits after SHA, so use since\n\nCloses #45\n\nBreaking Change: Breaks everything"},"html_url":"https://github.com/mrchief/actions-test/commit/b09fc019cb9497d31d483f66b796b4ad5faa14a4"},{"hash":"9d10351f05d7243fdfba582ae6d9ef3da470573d","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-27T01:11:21Z"},"message":"fix: Correctly grab sha of last tag"},"html_url":"https://github.com/mrchief/actions-test/commit/9d10351f05d7243fdfba582ae6d9ef3da470573d"},{"hash":"c517031b0b943ddc904ef9c98d8f1d7786ba0618","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-27T01:03:59Z"},"message":"chore: Cleanup log statements, extraneous set outputs"},"html_url":"https://github.com/mrchief/actions-test/commit/c517031b0b943ddc904ef9c98d8f1d7786ba0618"},{"hash":"65902bb43a38a8a6d935f3fb0636abdd4b883219","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-27T00:55:44Z"},"message":"chore: Release 2020-07-27 00:55:24Z (#12)\n\nCo-authored-by: GitHub Actions <mrchief mrchief@users.noreply.github.com>"},"html_url":"https://github.com/mrchief/actions-test/commit/65902bb43a38a8a6d935f3fb0636abdd4b883219"},{"hash":"90abd66af70b11fe0c25462e28cd33fed7e51d46","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-27T00:54:42Z"},"message":"fix: Syntax error"},"html_url":"https://github.com/mrchief/actions-test/commit/90abd66af70b11fe0c25462e28cd33fed7e51d46"},{"hash":"04d76a113c386ce811207cc5d86086db427e0188","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-26T21:23:17Z"},"message":"chore: Release 2020-07-26 21:22:51Z (#11)\n\nCo-authored-by: GitHub Actions <mrchief mrchief@users.noreply.github.com>"},"html_url":"https://github.com/mrchief/actions-test/commit/04d76a113c386ce811207cc5d86086db427e0188"},{"hash":"82596346b7bfcc975f2525b4dbe25e9e617a0707","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T21:22:16Z"},"message":"ci: Only use update release"},"html_url":"https://github.com/mrchief/actions-test/commit/82596346b7bfcc975f2525b4dbe25e9e617a0707"},{"hash":"7dcca524d2690027d15e61f60718e3a17563c232","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-26T21:16:42Z"},"message":"chore: Release 2020-07-26 21:16:27Z (#10)\n\nCo-authored-by: GitHub Actions <mrchief mrchief@users.noreply.github.com>"},"html_url":"https://github.com/mrchief/actions-test/commit/7dcca524d2690027d15e61f60718e3a17563c232"},{"hash":"445fa445c7fecec8b2ca976c69402e502a9259a2","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T21:16:00Z"},"message":"fix: create tage"},"html_url":"https://github.com/mrchief/actions-test/commit/445fa445c7fecec8b2ca976c69402e502a9259a2"},{"hash":"3ccfa7909223aebcb56407ecd1777c2f56b7e9af","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-26T21:12:29Z"},"message":"chore: Release 2020-07-26 21:12:09Z (#9)\n\nCo-authored-by: GitHub Actions <mrchief mrchief@users.noreply.github.com>"},"html_url":"https://github.com/mrchief/actions-test/commit/3ccfa7909223aebcb56407ecd1777c2f56b7e9af"},{"hash":"f003b15e43ceca7dbb8e50c4291c656c743a9614","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T21:10:27Z"},"message":"fix: owner repo refs"},"html_url":"https://github.com/mrchief/actions-test/commit/f003b15e43ceca7dbb8e50c4291c656c743a9614"},{"hash":"7a3aec868a1695b3f86b719eea1413023f25953d","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-26T21:11:13Z"},"message":"chore: Release 2020-07-26 21:11:00Z (#8)\n\nCo-authored-by: GitHub Actions <mrchief mrchief@users.noreply.github.com>"},"html_url":"https://github.com/mrchief/actions-test/commit/7a3aec868a1695b3f86b719eea1413023f25953d"},{"hash":"6eacff88368a0d91af3c6f8638c43241d9453c07","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-26T21:09:08Z"},"message":"chore: Release 2020-07-26 21:08:41Z (#7)\n\nCo-authored-by: GitHub Actions <mrchief mrchief@users.noreply.github.com>"},"html_url":"https://github.com/mrchief/actions-test/commit/6eacff88368a0d91af3c6f8638c43241d9453c07"},{"hash":"ba454b933d8a4179cc135fc64e6e5dfafd66d345","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T21:06:17Z"},"message":"fix: branch path on pr close"},"html_url":"https://github.com/mrchief/actions-test/commit/ba454b933d8a4179cc135fc64e6e5dfafd66d345"},{"hash":"e0aa78b02869398ab435635817fff450501bdd3a","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-26T21:07:05Z"},"message":"chore: Release 2020-07-26 21:06:45Z (#6)\n\nCo-authored-by: GitHub Actions <mrchief mrchief@users.noreply.github.com>"},"html_url":"https://github.com/mrchief/actions-test/commit/e0aa78b02869398ab435635817fff450501bdd3a"},{"hash":"d795e7816c5d3cbaf5451d19f93b8a10168beb6f","commit":{"author":{"name":"github-actions[bot]","email":"41898282+github-actions[bot]@users.noreply.github.com","date":"2020-07-26T21:05:19Z"},"message":"chore: Release 2020-07-26 21:04:33Z (#5)\n\nCo-authored-by: GitHub Actions <mrchief mrchief@users.noreply.github.com>"},"html_url":"https://github.com/mrchief/actions-test/commit/d795e7816c5d3cbaf5451d19f93b8a10168beb6f"},{"hash":"c17900c9f0ea0d8d4c3e1dbf0d847df6bf2196ce","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T21:04:04Z"},"message":"fix: Typo"},"html_url":"https://github.com/mrchief/actions-test/commit/c17900c9f0ea0d8d4c3e1dbf0d847df6bf2196ce"},{"hash":"2447ee63669c1413d47838af82c7ae31bc2c8d1a","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T21:03:05Z"},"message":"ci: Create PR manually"},"html_url":"https://github.com/mrchief/actions-test/commit/2447ee63669c1413d47838af82c7ae31bc2c8d1a"},{"hash":"51286363ff81faee2fcf5c0ecc666817ba183f21","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T20:52:27Z"},"message":"fix: Properly set branch name"},"html_url":"https://github.com/mrchief/actions-test/commit/51286363ff81faee2fcf5c0ecc666817ba183f21"},{"hash":"47d998526fd696cc76c7b5e1f9168cf0f6ea1dd1","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T20:46:50Z"},"message":"fix: Use head ref to get only branch name"},"html_url":"https://github.com/mrchief/actions-test/commit/47d998526fd696cc76c7b5e1f9168cf0f6ea1dd1"},{"hash":"565d189cb06f50d9c9765bad25eb6381f7f9ae3a","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T20:41:00Z"},"message":"ci: Commit manually"},"html_url":"https://github.com/mrchief/actions-test/commit/565d189cb06f50d9c9765bad25eb6381f7f9ae3a"},{"hash":"c2c1a0ec2026c3987bc51f8e65fad99f1e1a74fe","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T20:35:49Z"},"message":"debug: Git status"},"html_url":"https://github.com/mrchief/actions-test/commit/c2c1a0ec2026c3987bc51f8e65fad99f1e1a74fe"},{"hash":"e6a9c3a0c94d4f4347e39afac26b9d88c9874c87","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T20:31:47Z"},"message":"debug: Uncommitted changes"},"html_url":"https://github.com/mrchief/actions-test/commit/e6a9c3a0c94d4f4347e39afac26b9d88c9874c87"},{"hash":"61e831c02b2c6fa62a5f027a78a9efa16bb4656e","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T20:27:38Z"},"message":"ci: More robust way of updating changelog"},"html_url":"https://github.com/mrchief/actions-test/commit/61e831c02b2c6fa62a5f027a78a9efa16bb4656e"},{"hash":"b6bb37c970563ced137641ba6e8671296298df31","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T20:25:05Z"},"message":"ci: Create auto pull request"},"html_url":"https://github.com/mrchief/actions-test/commit/b6bb37c970563ced137641ba6e8671296298df31"},{"hash":"d2867d87c12d7091ec45d5e5313327add0492ff0","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T20:07:15Z"},"message":"ci: update job name"},"html_url":"https://github.com/mrchief/actions-test/commit/d2867d87c12d7091ec45d5e5313327add0492ff0"},{"hash":"8d7a6da99f6145a32da789891c1aac53706ff460","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T19:57:54Z"},"message":"ci: Add open/close workflows"},"html_url":"https://github.com/mrchief/actions-test/commit/8d7a6da99f6145a32da789891c1aac53706ff460"},{"hash":"70885039103aa8556933aac4376b6bc5aecbecd4","commit":{"author":{"name":"Hrusikesh Panda","email":"mrchief_2000@yahoo.com","date":"2020-07-26T19:18:01Z"},"message":"fix: Correct sha reference"},"html_url":"https://github.com/mrchief/actions-test/commit/70885039103aa8556933aac4376b6bc5aecbecd4"}]'

      - name: Echo changelog
        run: |
          # add new changelog to the beginning
          echo <<- 'EOF'
          ${{ steps.changelog.outputs.changelog }}
          EOF
